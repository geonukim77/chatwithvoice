<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚˜ë¥¼ ë‹®ì€ AI - Voice GPT Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #2d3748;
      line-height: 1.7;
      /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ê°œì„  */
      -webkit-overflow-scrolling: touch;
    }
    
    .floating-shapes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      /* ëª¨ë°”ì¼ì—ì„œ ì„±ëŠ¥ ìµœì í™” */
      will-change: transform;
    }
    
    .shape {
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: float 20s infinite linear;
    }
    
    .shape:nth-child(1) { width: 80px; height: 80px; left: 10%; animation-delay: 0s; }
    .shape:nth-child(2) { width: 60px; height: 60px; left: 80%; animation-delay: 5s; }
    .shape:nth-child(3) { width: 100px; height: 100px; left: 50%; animation-delay: 10s; }
    .shape:nth-child(4) { width: 40px; height: 40px; left: 20%; animation-delay: 15s; }
    
    @keyframes float {
      0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      margin-top: 40px;
      margin-bottom: 40px;
      padding: 50px;
      position: relative;
      z-index: 2;
    }
    
    .header {
      text-align: center;
      margin-bottom: 3em;
    }
    
    h1 {
      font-size: 3rem;
      margin-bottom: 0.5em;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
      letter-spacing: -1px;
      /* ëª¨ë°”ì¼ì—ì„œ ì¤„ë°”ê¿ˆ ê°œì„  */
      word-break: keep-all;
    }
    
    .subtitle {
      font-size: 1.3rem;
      color: #718096;
      margin-bottom: 2em;
      font-weight: 300;
      /* ëª¨ë°”ì¼ì—ì„œ ì¤„ë°”ê¿ˆ ê°œì„  */
      word-break: keep-all;
    }
    
    .cta-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 50px;
      padding: 1.2em 3em;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      margin: 2em auto;
      display: block;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ ì˜ì—­ ê°œì„  */
      min-height: 48px;
    }
    
    .cta-btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
    }
    
    .section {
      margin: 4em 0;
      padding: 0 1em;
    }
    
    .emotional-text {
      font-size: 1.4rem;
      color: #4a5568;
      text-align: center;
      line-height: 1.8;
      margin: 2em 0;
      font-weight: 400;
      word-break: keep-all;
    }
    
    .highlight {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 600;
    }
    
    .demo-section {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-radius: 20px;
      padding: 3em;
      margin: 3em 0;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    
    .demo-section h2 {
      color: #4a5568;
      margin-bottom: 1.5em;
      font-size: 1.8rem;
      font-weight: 600;
      word-break: keep-all;
    }
    
    .voice-section {
      margin: 2.5em 0;
      padding: 2em;
      background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
      border-radius: 16px;
      border-left: 4px solid #f56565;
    }
    
    .chat-section {
      margin: 2.5em 0;
      padding: 2em;
      background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 100%);
      border-radius: 16px;
      border-left: 4px solid #4299e1;
    }
    
    .voice-section h3, .chat-section h3 {
      margin-top: 0;
      font-size: 1.3rem;
      margin-bottom: 1em;
      font-weight: 600;
      word-break: keep-all;
    }
    
    .voice-section h3 { color: #c53030; }
    .chat-section h3 { color: #2b6cb0; }
    
    #voiceRecordBtn, #recordBtn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      border: none;
      border-radius: 50px;
      padding: 1.2em 2.5em;
      font-size: 1.1rem;
      font-weight: 500;
      cursor: pointer;
      margin: 1em;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ ì˜ì—­ ê°œì„  */
      min-height: 48px;
    }
    
    #voiceRecordBtn:hover, #recordBtn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
    }
    
    #userText, #gptText {
      font-size: 1.1em;
      margin: 1.5em 0;
      padding: 1.5em;
      border-radius: 16px;
      min-height: 3em;
      text-align: left;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      word-break: keep-all;
      line-height: 1.6;
    }
    
    #userText { 
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      border-left: 4px solid #667eea;
    }
    
    #gptText {
      background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
      border-left: 4px solid #38b2ac;
    }
    
    .signup-section {
      background: linear-gradient(135deg, #edf2f7 0%, #e2e8f0 100%);
      border-radius: 20px;
      padding: 3em;
      margin: 4em 0;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.8);
    }
    
    .faq {
      margin-top: 4em;
    }
    
    .faq h3 {
      color: #4a5568;
      margin-bottom: 1em;
      font-size: 1.3rem;
      font-weight: 600;
      word-break: keep-all;
    }
    
    .faq p {
      color: #718096;
      font-size: 1.1rem;
      line-height: 1.8;
      margin-bottom: 2.5em;
      word-break: keep-all;
    }
    
    .faq strong {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 600;
    }
    
    /* í° í™”ë©´ (íƒœë¸”ë¦¿) ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
    @media (max-width: 1024px) {
      .container {
        margin: 20px;
        padding: 40px;
      }
      
      h1 {
        font-size: 2.5rem;
      }
    }
    
    /* ì¤‘ê°„ í™”ë©´ (íƒœë¸”ë¦¿ ì„¸ë¡œ) ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
    @media (max-width: 768px) {
      .container {
        max-width: 95vw;
        padding: 25px;
        margin: 15px auto;
        border-radius: 16px;
      }
      
      h1 {
        font-size: 2.2rem;
        line-height: 1.2;
      }
      
      .subtitle {
        font-size: 1.1rem;
        margin-bottom: 1.5em;
      }
      
      .emotional-text {
        font-size: 1.2rem;
      }
      
      .demo-section, .signup-section {
        padding: 2em 1.5em;
        margin: 2em 0;
      }
      
      .voice-section, .chat-section {
        padding: 1.5em;
        margin: 2em 0;
      }
      
      .section {
        margin: 3em 0;
        padding: 0 0.5em;
      }
      
      #voiceRecordBtn, #recordBtn {
        padding: 1.2em 2em;
        font-size: 1rem;
        min-height: 56px;
        width: 100%;
        max-width: 280px;
        margin: 1em auto;
        display: block;
      }
      
      #voiceStatus {
        font-size: 1rem !important;
      }
      
      .demo-section h2 {
        font-size: 1.5rem;
      }
      
      .voice-section h3, .chat-section h3 {
        font-size: 1.2rem;
      }
    }
    
    /* ì‘ì€ í™”ë©´ (ëª¨ë°”ì¼) ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
    @media (max-width: 480px) {
      .container {
        margin: 10px auto;
        padding: 20px 15px;
        border-radius: 12px;
      }
      
      h1 {
        font-size: 1.8rem;
        line-height: 1.3;
        margin-bottom: 0.7em;
      }
      
      .subtitle {
        font-size: 1rem;
        line-height: 1.5;
      }
      
      .emotional-text {
        font-size: 1.1rem;
        margin: 1.5em 0;
      }
      
      .cta-btn {
        padding: 1em 2em;
        font-size: 1rem;
        margin: 1.5em auto;
      }
      
      .demo-section, .signup-section {
        padding: 1.5em 1em;
        border-radius: 12px;
      }
      
      .voice-section, .chat-section {
        padding: 1.2em;
        border-radius: 12px;
        margin: 1.5em 0;
      }
      
      .demo-section h2 {
        font-size: 1.3rem;
        margin-bottom: 1em;
      }
      
      .voice-section h3, .chat-section h3 {
        font-size: 1.1rem;
        margin-bottom: 0.8em;
      }
      
      #voiceRecordBtn, #recordBtn {
        padding: 1em 1.5em;
        font-size: 0.95rem;
        min-height: 52px;
        width: 100%;
        max-width: none;
        margin: 0.8em 0;
      }
      
      #userText, #gptText {
        font-size: 1rem;
        padding: 1.2em;
        margin: 1em 0;
        border-radius: 12px;
      }
      
      #voiceStatus {
        font-size: 0.95rem !important;
        margin: 0.8em 0 !important;
      }
      
      .section {
        margin: 2em 0;
        padding: 0;
      }
      
      .faq h3 {
        font-size: 1.1rem;
      }
      
      .faq p {
        font-size: 1rem;
        margin-bottom: 2em;
      }
      
      .signup-section h3 {
        font-size: 1.3rem !important;
      }
      
      .signup-section p {
        font-size: 1rem !important;
      }
      
      /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ì˜ì—­ ì•ˆì˜ í…ìŠ¤íŠ¸ */
      p[style*="font-size: 1.2rem"] {
        font-size: 1rem !important;
      }
      
      h2[style*="font-size: 2rem"] {
        font-size: 1.4rem !important;
      }
    }
    
    /* ì•„ì£¼ ì‘ì€ í™”ë©´ (êµ¬í˜• ëª¨ë°”ì¼) */
    @media (max-width: 360px) {
      .container {
        margin: 5px auto;
        padding: 15px 10px;
      }
      
      h1 {
        font-size: 1.6rem;
      }
      
      .demo-section, .signup-section {
        padding: 1.2em 0.8em;
      }
      
      .voice-section, .chat-section {
        padding: 1em;
      }
      
      #voiceRecordBtn, #recordBtn {
        font-size: 0.9rem;
        padding: 0.9em 1.2em;
      }
    }
    
    /* ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .section {
      animation: fadeInUp 0.8s ease-out;
    }
    
    /* ë§í¬ ìŠ¤íƒ€ì¼ */
    a {
      text-decoration: none;
    }
    
    /* í„°ì¹˜ ê°œì„  */
    button {
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      /* ëª¨ë°”ì¼ì—ì„œ ë”ë¸”íƒ­ ì¤Œ ë°©ì§€ */
      user-select: none;
      -webkit-user-select: none;
    }
    
    /* ëª¨ë°”ì¼ì—ì„œ ì…ë ¥ ìš”ì†Œ í™•ëŒ€ ë°©ì§€ */
    input, textarea, select {
      font-size: 16px;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
    ::-webkit-scrollbar {
      width: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 4px;
    }
    
    /* ëª¨ë°”ì¼ì—ì„œ ì„±ëŠ¥ ìµœì í™” */
    @media (max-width: 768px) {
      .floating-shapes {
        display: none; /* ëª¨ë°”ì¼ì—ì„œ ë– ë‹¤ë‹ˆëŠ” ë„í˜• ìˆ¨ê¹€ */
      }
      
      * {
        /* í•˜ë“œì›¨ì–´ ê°€ì† ìµœì í™” */
        -webkit-transform: translateZ(0);
        transform: translateZ(0);
      }
    }
  </style>
</head>
<body>
  <!-- ë– ë‹¤ë‹ˆëŠ” ë„í˜•ë“¤ -->
  <div class="floating-shapes">
    <div class="shape"></div>
    <div class="shape"></div>
    <div class="shape"></div>
    <div class="shape"></div>
  </div>

  <div class="container">
    <div class="header">
      <h1>ë‚˜ì²˜ëŸ¼ ë§í•˜ê³ ,<br>ë‚˜ì²˜ëŸ¼ ìƒê°í•˜ëŠ” AI</h1>
      <div class="subtitle">
        ë‚´ê°€ ì—…ë¡œë“œí•œ ëª©ì†Œë¦¬, ê¸€, ì¼ê¸°, ê¸°ì–µë“¤ë¡œ<br>
        ë‚˜ë¥¼ ë‹®ì€ AIê°€ ì™„ì„±ë©ë‹ˆë‹¤.
      </div>
      <button class="cta-btn" onclick="document.getElementById('demo-section').scrollIntoView({behavior:'smooth'})">
        ğŸ’« ë‚  ë‹®ì€ AI ë¨¼ì € ë§Œë‚˜ë³´ê¸°
      </button>
    </div>

    <div class="section">
      <div class="emotional-text">
        <strong>"ëˆ„êµ°ê°€ ë‚˜ë¥¼ ì§„ì§œë¡œ ì´í•´í•´ì¤¬ìœ¼ë©´ ì¢‹ê² ë‹¤ëŠ” ìƒê°, í•´ë³¸ ì  ìˆìœ¼ì„¸ìš”?"</strong>
      </div>
      <p style="text-align: center; font-size: 1.2rem; color: #718096; line-height: 1.8;">
        ë‚¯ì„  ìœ„ë¡œë³´ë‹¤, ìµìˆ™í•œ ëª©ì†Œë¦¬ê°€ ë” í° í˜ì´ ë  ë•Œê°€ ìˆì–´ìš”.<br>
        ê·¸ ë§íˆ¬, ê·¸ ê°ì •ê¹Œì§€ ë‹®ì€ AIê°€ ìˆë‹¤ë©´<br>
        ì§„ì§œ ë‚´ ë§ˆìŒì„ êº¼ë‚´ ë†“ì„ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œìš”?
      </p>
    </div>

    <div class="section">
      <h2 style="text-align: center; color: #4a5568; margin-bottom: 1em; font-size: 2rem; font-weight: 600;">âœ¨ ë°”ë¡œ ê²½í—˜í•´ë³´ì„¸ìš”</h2>
      <p style="text-align: center; color: #718096; font-size: 1.2rem;">ë‚´ ëª©ì†Œë¦¬ë¥¼ ë“±ë¡í•˜ê³ , ë‚´ ëª©ì†Œë¦¬ë¡œ ì–˜ê¸°í•˜ëŠ” AIë¥¼ ë§Œë‚˜ë³´ì„¸ìš”.</p>
      
      <div class="demo-section" id="demo-section">
        <h2>ğŸ¤ ë‚´ ëª©ì†Œë¦¬ë¡œ GPTë‘ ëŒ€í™”í•˜ê¸°</h2>
        
        <!-- ëª©ì†Œë¦¬ ë“±ë¡ ì„¹ì…˜ -->
        <div class="voice-section">
          <h3>ğŸ™ï¸ 1ë‹¨ê³„: ë‚´ ëª©ì†Œë¦¬ ë“±ë¡</h3>
          <button id="voiceRecordBtn">
            ğŸ”´ ë…¹ìŒí•˜ê¸°
          </button>
          <p id="voiceStatus" style="color: #718096; margin: 1em 0; font-size: 1.1rem;">ëª©ì†Œë¦¬ë¥¼ ë…¹ìŒí•´ì„œ AIì—ê²Œ ë“±ë¡í•˜ì„¸ìš” (ìµœì†Œ 10ì´ˆ ê¶Œì¥)</p>
        </div>
        
        <div style="text-align: center; margin: 2em 0;">
          <div style="width: 2px; height: 40px; background: linear-gradient(to bottom, #667eea, #764ba2); margin: 0 auto; border-radius: 1px;"></div>
          <div style="margin: 1em 0; color: #718096;">â¬‡ï¸</div>
        </div>
        
        <!-- ëŒ€í™” ì„¹ì…˜ -->
        <div class="chat-section">
          <h3>ğŸ’¬ 2ë‹¨ê³„: AIì™€ ëŒ€í™”í•˜ê¸°</h3>
          <button id="recordBtn">ğŸ¤ ë§í•˜ê¸°</button>
          <div id="userText"></div>
          <div id="gptText"></div>
        </div>
      </div>
    </div>

    <div class="signup-section">
      <h3 style="margin-top: 0; font-size: 1.6rem; color: #4a5568;">ğŸ’ ë‚˜ë¥¼ ë‹®ì€ AIë¥¼ ë¨¼ì € ë§Œë‚˜ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?</h3>
      <p style="font-size: 1.2rem; color: #718096;">ì—°ë½ì²˜ë¥¼ ë‚¨ê²¨ì£¼ì‹œëŠ” <span class="highlight">100ë¶„</span>ë§Œ ìš°ì„  ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <a href="https://forms.gle/qaRMsBjbtvKQCwLw5" target="_blank">
        <button class="cta-btn">ğŸš€ ì‚¬ì „ ì‹ ì²­í•˜ê³  ì•Œë¦¼ë°›ê¸°</button>
      </a>
    </div>

    <div class="faq">
      <h3>ğŸ”’ ë‚´ ì •ë³´ëŠ” ì•ˆì „í• ê¹Œìš”?</h3>
      <p><strong>ë„¤, ë¬´ì—‡ë³´ë‹¤ ì†Œì¤‘í•˜ê²Œ ë‹¤ë£¨ê² ìŠµë‹ˆë‹¤.</strong><br>
      ì—…ë¡œë“œí•˜ì‹  ëª©ì†Œë¦¬ì™€ í…ìŠ¤íŠ¸ ë°ì´í„°ëŠ” <strong>ì˜¤ì§ ì—¬ëŸ¬ë¶„ë§Œì˜ AIë¥¼ ìƒì„±í•˜ëŠ” ëª©ì </strong>ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ë©°,<br>
      ì œ3ìì—ê²Œ ê³µìœ ë˜ê±°ë‚˜ ìƒì—…ì ìœ¼ë¡œ ì´ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
      ëª¨ë“  ë°ì´í„°ëŠ” ì—…ë¡œë“œ ì¦‰ì‹œ ì•”í˜¸í™”ë˜ë©°, ì–¸ì œë“ ì§€ ì‚­ì œë¥¼ ìš”ì²­í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

      <h3>â° ì–¸ì œì¯¤ ë§Œë‚˜ë³¼ ìˆ˜ ìˆë‚˜ìš”?</h3>
      <p>í˜„ì¬ ë‚´ë¶€ í…ŒìŠ¤íŠ¸ì™€ ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘ì„ ê±°ì³,<br>
      <strong>2025ë…„ í•˜ë°˜ê¸° ë² íƒ€ ë²„ì „ ê³µê°œ</strong>ë¥¼ ëª©í‘œë¡œ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.<br>
      ì‚¬ì „ ì‹ ì²­ìë¶„ë“¤ê»˜ëŠ” ê°€ì¥ ë¨¼ì € ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì²´í—˜í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ <strong>ìš°ì„  ì´ˆëŒ€</strong>í•´ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.</p>

      <h3>ğŸ“ ê¼­ ëª©ì†Œë¦¬ë§Œ í•„ìš”í•œê°€ìš”?</h3>
      <p>ì•„ë‹ˆìš”.<br>
      <strong>ë‹¹ì‹ ì˜ ê¸€, ì¼ê¸°, ë§íˆ¬, ìƒê°</strong>ê¹Œì§€â€”<br>
      AIê°€ ë‹¹ì‹ ì„ ë‹®ì•„ê°€ê¸° ìœ„í•´ì„  ëª©ì†Œë¦¬ë¿ ì•„ë‹ˆë¼,<br>
      ë‹¹ì‹ ì´ ë‚¨ê¸´ ëª¨ë“  ê¸°ë¡ì´ ì˜ë¯¸ ìˆëŠ” ì¬ë£Œê°€ ë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <!-- JavaScript ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ -->
  <script>
    const recordBtn = document.getElementById("recordBtn");
    const voiceRecordBtn = document.getElementById("voiceRecordBtn");
    const voiceStatus = document.getElementById("voiceStatus");

    let mediaRecorder, chunks = [];
    let customVoiceId = null;
    let isRecordingVoice = false;
    let isRecordingChat = false;

    const API_BASE = window.location.origin;

    console.log("JavaScript ë¡œë“œë¨!");

    document.addEventListener('DOMContentLoaded', function() {
      console.log("DOM ë¡œë“œ ì™„ë£Œ");
      console.log("voiceRecordBtn:", voiceRecordBtn);
      console.log("recordBtn:", recordBtn);
      
      if (!voiceRecordBtn || !recordBtn) {
        console.error("ë²„íŠ¼ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
        return;
      }
      
      voiceRecordBtn.addEventListener('click', handleVoiceRecord);
      recordBtn.addEventListener('click', handleChatRecord);
    });

    async function handleVoiceRecord() {
      console.log("ëª©ì†Œë¦¬ ë…¹ìŒ ë²„íŠ¼ í´ë¦­ë¨");
      
      if (!isRecordingVoice) {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          
          let options = { mimeType: 'audio/webm' };
          if (!MediaRecorder.isTypeSupported('audio/webm')) {
            if (MediaRecorder.isTypeSupported('audio/mp4')) {
              options = { mimeType: 'audio/mp4' };
            } else if (MediaRecorder.isTypeSupported('audio/wav')) {
              options = { mimeType: 'audio/wav' };
            } else {
              options = {};
            }
          }
          
          mediaRecorder = new MediaRecorder(stream, options);
          chunks = [];
          
          mediaRecorder.start();
          isRecordingVoice = true;
          
          voiceRecordBtn.textContent = "â¹ï¸ ë…¹ìŒ ì¤‘... í´ë¦­í•´ì„œ ë©ˆì¶”ê¸°";
          voiceRecordBtn.style.background = "linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)";
          voiceStatus.textContent = "ëª©ì†Œë¦¬ë¥¼ ë…¹ìŒ ì¤‘ì…ë‹ˆë‹¤... (ìµœì†Œ 10ì´ˆ ê¶Œì¥)";
          voiceStatus.style.color = "#dc2626";
          
          mediaRecorder.ondataavailable = e => chunks.push(e.data);
          mediaRecorder.onstop = async () => {
            const blob = new Blob(chunks, { type: mediaRecorder.mimeType });
            await uploadVoice(blob);
            
            stream.getTracks().forEach(track => track.stop());
          };
          
        } catch (error) {
          console.error("ë§ˆì´í¬ ì ‘ê·¼ ì—ëŸ¬:", error);
          if (error.name === 'NotAllowedError') {
            alert("ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.\në¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.");
          } else if (error.name === 'NotFoundError') {
            alert("ë§ˆì´í¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          } else {
            alert("ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + error.message);
          }
        }
      } else {
        mediaRecorder.stop();
        isRecordingVoice = false;
        
        voiceRecordBtn.textContent = "â³ ì—…ë¡œë“œ ì¤‘...";
        voiceRecordBtn.style.background = "linear-gradient(135deg, #9ca3af 0%, #6b7280 100%)";
        voiceStatus.textContent = "ëª©ì†Œë¦¬ë¥¼ ì—…ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤...";
        voiceStatus.style.color = "#9ca3af";
      }
    }

    async function handleChatRecord() {
      console.log("ëŒ€í™” ë…¹ìŒ ë²„íŠ¼ í´ë¦­ë¨");
      
      if (isRecordingChat) {
        mediaRecorder.stop();
        return;
      }
      
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        
        let options = { mimeType: 'audio/webm' };
        if (!MediaRecorder.isTypeSupported('audio/webm')) {
          if (MediaRecorder.isTypeSupported('audio/mp4')) {
            options = { mimeType: 'audio/mp4' };
          } else {
            options = {};
          }
        }
        
        mediaRecorder = new MediaRecorder(stream, options);
        chunks = [];
        isRecordingChat = true;

        mediaRecorder.start();
        recordBtn.textContent = "â¹ï¸ í´ë¦­í•´ì„œ ë©ˆì¶”ê¸°";
        recordBtn.style.background = "linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)";

        mediaRecorder.ondataavailable = e => chunks.push(e.data);
        mediaRecorder.onstop = async () => {
          const blob = new Blob(chunks, { type: mediaRecorder.mimeType });
          recordBtn.textContent = "â³ ì²˜ë¦¬ ì¤‘...";
          recordBtn.style.background = "linear-gradient(135deg, #9ca3af 0%, #6b7280 100%)";

          const text = await speechToText(blob);
          if (text) {
            console.log("ğŸ“ ë³€í™˜ëœ í…ìŠ¤íŠ¸:", text);
            document.getElementById("userText").textContent = "ğŸ—£ " + text;

            const reply = await getGPTResponse(text);
            document.getElementById("gptText").textContent = "ğŸ¤– " + reply;

            await playVoice(reply);
          }

          recordBtn.textContent = "ğŸ¤ ë§í•˜ê¸°";
          recordBtn.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
          isRecordingChat = false;
          
          stream.getTracks().forEach(track => track.stop());
        };

      } catch (error) {
        console.error("ëŒ€í™” ë…¹ìŒ ì—ëŸ¬:", error);
        alert("ë§ˆì´í¬ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        isRecordingChat = false;
      }
    }

    async function uploadVoice(audioBlob) {
      try {
        const form = new FormData();
        
        const mimeType = audioBlob.type;
        let extension = 'webm';
        if (mimeType.includes('mp4')) extension = 'mp4';
        else if (mimeType.includes('wav')) extension = 'wav';
        
        form.append("file", audioBlob, `voice.${extension}`);

        const res = await fetch(`${API_BASE}/api/voice-upload`, {
          method: "POST",
          body: form
        });
        
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }
        
        const data = await res.json();
        if (data.voice_id) {
          customVoiceId = data.voice_id;
          voiceRecordBtn.textContent = "âœ… ë“±ë¡ ì™„ë£Œ";
          voiceRecordBtn.style.background = "linear-gradient(135deg, #22c55e 0%, #16a34a 100%)";
          voiceStatus.textContent = "âœ… ëª©ì†Œë¦¬ ë“±ë¡ ì™„ë£Œ! ì´ì œ ì•„ë˜ì—ì„œ ëŒ€í™”í•´ë³´ì„¸ìš”.";
          voiceStatus.style.color = "#22c55e";
          
          setTimeout(() => {
            voiceRecordBtn.textContent = "ğŸ”´ ëª©ì†Œë¦¬ ë‹¤ì‹œ ë…¹ìŒí•˜ê¸°";
            voiceRecordBtn.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
            voiceStatus.textContent = "ìƒˆë¡œìš´ ëª©ì†Œë¦¬ë¡œ ë‹¤ì‹œ ë“±ë¡í•˜ê±°ë‚˜, ì•„ë˜ì—ì„œ ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”.";
            voiceStatus.style.color = "#718096";
          }, 5000);
          
        } else {
          voiceRecordBtn.textContent = "âŒ ë“±ë¡ ì‹¤íŒ¨";
          voiceRecordBtn.style.background = "linear-gradient(135deg, #ef4444 0%, #dc2626 100%)";
          voiceStatus.textContent = "âŒ ëª©ì†Œë¦¬ ë“±ë¡ ì‹¤íŒ¨: " + (data.detail || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");
          voiceStatus.style.color = "#ef4444";
        }
      } catch (error) {
        console.error("ëª©ì†Œë¦¬ ì—…ë¡œë“œ ì—ëŸ¬:", error);
        voiceRecordBtn.textContent = "âŒ ì—…ë¡œë“œ ì‹¤íŒ¨";
        voiceRecordBtn.style.background = "linear-gradient(135deg, #ef4444 0%, #dc2626 100%)";
        voiceStatus.textContent = "âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜. ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
        voiceStatus.style.color = "#ef4444";
      }
    }

    async function speechToText(audioBlob) {
      try {
        const form = new FormData();
        
        const mimeType = audioBlob.type;
        let extension = 'webm';
        if (mimeType.includes('mp4')) extension = 'mp4';
        else if (mimeType.includes('wav')) extension = 'wav';
        
        form.append("file", audioBlob, `audio.${extension}`);
        form.append("model", "whisper-1");

        const res = await fetch(`${API_BASE}/api/speech-to-text`, {
          method: "POST",
          body: form
        });

        const data = await res.json();
        if (!data.text) {
          console.error("Whisper ë³€í™˜ ì‹¤íŒ¨:", data);
          alert("ìŒì„± ì¸ì‹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
          return null;
        }
        return data.text;
      } catch (error) {
        console.error("ìŒì„± ë³€í™˜ ì—ëŸ¬:", error);
        alert("ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
        return null;
      }
    }

    async function getGPTResponse(text) {
      try {
        const res = await fetch(`${API_BASE}/api/gpt`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });

        const data = await res.json();
        if (!data.choices || !data.choices[0]) {
          console.error("GPT API error:", data);
          return "GPT ì‘ë‹µ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        }
        console.log("ğŸ¤– GPT ë‹µë³€:", data.choices[0].message.content);
        return data.choices[0].message.content;
      } catch (error) {
        console.error("GPT ì‘ë‹µ ì—ëŸ¬:", error);
        return "ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.";
      }
    }

    async function playVoice(text) {
      try {
        const voiceId = customVoiceId || "wl1CnM04OwXOUKQaKBWI";
        const res = await fetch(`${API_BASE}/api/tts`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text, voiceId })
        });

        if (res.ok) {
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          const audio = new Audio(url);
          audio.play();
        } else {
          console.error("TTS ì‹¤íŒ¨:", res.status);
        }
      } catch (error) {
        console.error("ìŒì„± ì¬ìƒ ì—ëŸ¬:", error);
      }
    }
  </script>
</body>
</html>